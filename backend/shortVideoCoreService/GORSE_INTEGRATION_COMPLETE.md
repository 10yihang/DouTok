# Gorse推荐系统完整集成方案

## 已完成的集成

### 1. 用户行为记录
#### 点赞/取消点赞行为
- **文件**: `internal/domain/service/favoriteservice/service.go`
- **行为类型**: 
  - `like`: 点赞行为
  - `dislike`: 取消点赞行为（负反馈）
- **实现方式**: 异步记录，不影响主业务流程

#### 收藏/取消收藏行为
- **文件**: `internal/domain/service/collectionservice/service.go`
- **行为类型**:
  - `collect`: 收藏行为
  - `uncollect`: 取消收藏行为（负反馈）
- **实现方式**: 异步记录，包含恢复收藏的场景

#### 视频观看行为
- **文件**: `internal/domain/service/videodomain/video.go`
- **行为类型**: `view`: 观看行为
- **触发时机**: 用户获取视频推荐时

#### 视频发布行为
- **文件**: `internal/domain/service/videodomain/video.go`
- **行为类型**: `publish`: 发布行为
- **作用**: 表示用户对该类型内容的创作偏好

### 2. 智能标签系统
#### 标签提取器
- **文件**: `internal/infrastructure/utils/tagging/video_tagger.go`
- **功能**: 基于关键词映射从标题和描述中提取语义标签
- **支持类别**:
  - 娱乐类 (entertainment, funny, comedy)
  - 音乐类 (music, singing, dance)
  - 美食类 (food, cooking, lifestyle)
  - 运动类 (sports, fitness, health)
  - 科技类 (technology, ai, programming)
  - 教育类 (education, learning, knowledge)
  - 生活类 (lifestyle, fashion, beauty)
  - 游戏类 (gaming, esports)
  - 情感类 (emotion, love, relationship)
  - 宠物动物类 (pet, animal)

#### 话题标签支持
- **格式**: `#标签名`
- **自动提取**: 支持中英文话题标签
- **默认标签**: 无法提取时返回 `general`

### 3. 推荐策略
#### 三层推荐机制
1. **个性化推荐**: 优先使用Gorse个性化推荐
2. **热门补充**: 推荐数量不足时补充热门内容
3. **时间排序**: Gorse不可用时回退到时间排序

#### 冷启动处理
- **新用户**: 自动使用热门视频推荐
- **数据不足**: 混合个性化和热门内容

### 4. 系统架构
#### 端口配置修正
- **Gorse HTTP**: 8088端口 (已修正从8087)
- **Gorse gRPC**: 8086端口
- **连接配置**: `http://localhost:8088`

#### 依赖注入更新
- **VideoUseCase**: 集成视频标签提取器
- **FavoriteService**: 注入Gorse适配器和日志器
- **CollectionService**: 注入Gorse适配器和日志器
- **所有Provider**: 更新以传递必要依赖

## 推荐效果优化策略

### 1. 用户画像构建
- **发布行为**: 分析用户发布的视频类型，构建创作偏好
- **互动行为**: 点赞、收藏、评论反映用户兴趣偏好
- **观看时长**: 未来可集成观看时长数据提升准确性

### 2. 内容理解
- **语义标签**: 基于NLP技术提取内容语义特征
- **多维度标签**: 支持主题、情感、风格等多维度标签
- **动态标签**: 根据用户反馈动态调整标签权重

### 3. 推荐多样性
- **兴趣探索**: 适当推荐用户未接触的优质内容
- **时效性平衡**: 结合热门趋势和个人兴趣
- **负反馈学习**: 利用取消点赞/收藏优化推荐

## 使用建议

### 1. 标签体系扩展
根据实际内容特点持续完善关键词映射：
```go
// 新增领域标签
"区块链": {"technology", "blockchain", "crypto"},
"元宇宙": {"technology", "metaverse", "vr"},
```

### 2. 行为权重调优
不同行为对推荐的影响权重：
- **收藏** > **点赞** > **观看** > **分享**
- **发布**行为可作为强正向信号

### 3. 实时性优化
- **异步处理**: 所有Gorse操作都是异步的，不影响用户体验
- **批量更新**: 考虑批量提交用户行为提升性能
- **缓存策略**: 热门推荐可以适当缓存

### 4. 监控指标
建议监控以下指标评估推荐效果：
- **点击率CTR**: 推荐视频的点击率
- **完播率**: 推荐视频的完整观看率
- **互动率**: 点赞、收藏、评论率
- **留存率**: 用户使用推荐功能的留存

## 下一步计划

1. **评论系统集成**: 为评论行为添加Gorse记录
2. **时长分析**: 集成视频观看时长数据
3. **社交推荐**: 基于关注关系的社交推荐
4. **实时推荐**: 基于用户实时行为的动态推荐调整
5. **A/B测试**: 不同推荐策略的效果对比测试

此集成方案实现了完整的个性化推荐系统，通过智能标签提取和多维度用户行为分析，为用户提供精准的内容推荐服务。
